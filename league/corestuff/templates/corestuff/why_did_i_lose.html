{% extends 'corestuff/base.html' %}

{% block title %}Why Did I Lose? - MentalBoom.gg{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center w-full py-10">
    
    <div class="w-full max-w-2xl bg-[#1a1a2e]/90 border border-gray-700 rounded-3xl p-8 flex flex-col items-center space-y-8 shadow-[0_0_40px_rgba(0,0,0,0.7)]">
        
        <div class="text-center">
            <h1 class="text-5xl font-black italic tracking-tighter text-white">
                LOSS <span class="text-red-500">ANALYSIS</span>
            </h1>
            <p class="text-gray-500 text-xs uppercase tracking-[0.4em] mt-2 font-bold">Deep Dive into the Throw</p>
        </div>

        <div class="w-full flex justify-center py-2">
            <button id="generate-btn" type="button"
                class="w-full sm:w-3/4 py-5 bg-gradient-to-r from-red-700 to-red-600 hover:from-red-600 hover:to-red-500 text-white font-black rounded-2xl shadow-[0_6px_0_rgb(127,29,29)] active:shadow-none active:translate-y-1 transition-all duration-75 uppercase tracking-widest text-xl">
                Analyze My Game üîç
            </button>
        </div>

        <div id="result-area" class="w-full border-t border-gray-800 pt-8 min-h-[350px] flex flex-col items-center">
            
            <div id="placeholder" class="text-gray-600 italic mt-16 text-center">
                <p class="text-2xl opacity-50">READY TO SCAN</p>
                <p class="text-xs uppercase mt-2">Standing by for Match ID...</p>
            </div>

            <div id="report-content" class="hidden w-full space-y-4">
                
                <div class="bg-red-500/10 border-l-4 border-red-500 p-4 rounded-r-xl">
                    <h3 class="text-red-500 text-[10px] font-black uppercase tracking-widest">Root Cause</h3>
                    <p id="res-cause" class="text-white text-lg font-medium italic"></p>
                </div>

                <div class="bg-orange-500/10 border-l-4 border-orange-500 p-4 rounded-r-xl">
                    <h3 class="text-orange-500 text-[10px] font-black uppercase tracking-widest">The Breaking Point</h3>
                    <p id="res-event" class="text-white text-lg font-medium"></p>
                </div>

                <div class="bg-purple-500/10 border-l-4 border-purple-500 p-4 rounded-r-xl">
                    <h3 class="text-purple-500 text-[10px] font-black uppercase tracking-widest">Psychological Toll</h3>
                    <p id="res-mental" class="text-white text-lg font-medium"></p>
                </div>

                <div class="bg-blue-500/10 border-l-4 border-blue-500 p-4 rounded-r-xl">
                    <h3 class="text-blue-500 text-[10px] font-black uppercase tracking-widest">Riot HQ Official Stance</h3>
                    <p id="res-riot" class="text-white text-lg font-medium"></p>
                </div>

                <div id="rare-box" class="hidden bg-yellow-500/20 border-2 border-yellow-500 p-4 rounded-2xl animate-pulse text-center">
                    <h3 class="text-yellow-500 text-xs font-black uppercase tracking-widest">‚ö†Ô∏è ULTRA RARE TRUTH ‚ö†Ô∏è</h3>
                    <p id="res-rare" class="text-yellow-100 text-xl font-black italic mt-1"></p>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('generate-btn').addEventListener('click', async () => {
    const btn = document.getElementById('generate-btn');
    const placeholder = document.getElementById('placeholder');
    const report = document.getElementById('report-content');
    const rareBox = document.getElementById('rare-box');

    // Button Visual Feedback
    btn.innerText = "Analyzing Replay...";
    btn.classList.add('opacity-50');

    try {
        const response = await fetch("{% url 'why_did_i_lose_api' %}");
        const data = await response.json();

        // Reveal the UI
        placeholder.classList.add('hidden');
        report.classList.remove('hidden');

        // Fill the data
        document.getElementById('res-cause').innerText = data.cause;
        document.getElementById('res-event').innerText = data.key_event;
        document.getElementById('res-mental').innerText = data.mental_damage;
        document.getElementById('res-riot').innerText = data.riot_explanation;

        // Handle Ultra Rare
        if (data.rare) {
            rareBox.classList.remove('hidden');
            document.getElementById('res-rare').innerText = data.rare;
        } else {
            rareBox.classList.add('hidden');
        }

    } catch (error) {
        console.error("Analysis Failed:", error);
    } finally {
        btn.innerText = "Analyze My Game üîç";
        btn.classList.remove('opacity-50');
    }
});
</script>
{% endblock %}